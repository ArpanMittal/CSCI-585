SELECT temp.FIR as First, temp.SECOND as Second
FROM
(SELECT fir.USER_ID as FIR, second.USER_ID as SECOND
FROM USERS fir, USERS second
WHERE fir.USER_ID!=second.USER_ID AND
NOT EXISTS
(
  SELECT * FROM FRIENDSHIPS 
  WHERE ((INVITER_ID = fir.USER_ID AND INVITEE_ID=second.USER_ID AND STATUS = '1') 
         OR (INVITEE_ID = fir.USER_ID AND INVITER_ID=second.USER_ID AND STATUS = '1'))
))temp, 
(
  SELECT u.USER_ID as USER_ID,  f.INVITER_ID as Main_first
      FROM FRIENDSHIPS f JOIN USERS u ON
      f.INVITEE_ID = u.USER_ID 
      WHERE f.STATUS = '1' AND f.INVITER_ID IN( SELECT USER_ID FROM USERS)
      AND f.INVITEE_ID != f.INVITER_ID
      UNION
      SELECT u.USER_ID as USER_ID,  f.INVITEE_ID as Main_first
      FROM FRIENDSHIPS f JOIN USERS u ON
      f.INVITER_ID = u.USER_ID 
      WHERE f.STATUS = '1' AND f.INVITEE_ID IN( SELECT USER_ID FROM USERS)
      AND f.INVITEE_ID != f.INVITER_ID
)temp_first,
(
  SELECT u.USER_ID as USER_ID,  f.INVITER_ID as Main_Second
      FROM FRIENDSHIPS f JOIN USERS u ON
      f.INVITEE_ID = u.USER_ID 
      WHERE f.STATUS = '1' AND f.INVITER_ID IN( SELECT USER_ID FROM USERS)
      AND f.INVITEE_ID != f.INVITER_ID
      UNION
      SELECT u.USER_ID as USER_ID,  f.INVITEE_ID as Main_first
      FROM FRIENDSHIPS f JOIN USERS u ON
      f.INVITER_ID = u.USER_ID 
      WHERE f.STATUS = '1' AND f.INVITEE_ID IN( SELECT USER_ID FROM USERS)
      AND f.INVITEE_ID != f.INVITER_ID
)temp_second
 WHERE temp.FIR = temp_first.Main_first
 AND temp.SECOND = temp_second.Main_Second
 AND temp_second.USER_ID = temp_first.USER_ID
 GROUP BY temp.FIR,temp.SECOND;
 
