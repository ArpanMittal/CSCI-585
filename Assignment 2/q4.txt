SELECT fr.USER_ID,COUNT(*) as NUMBER_OF_FRIEND
FROM 
(	SELECT u.USER_ID
	FROM USERS u
	JOIN (
	SELECT DISTINCT(COMMENTS.USER_ID)
	FROM POSTS JOIN COMMENTS
	ON POSTS.POST_ID = COMMENTS.POST_ID
	WHERE POSTS.USER_ID=10
	)m
	ON u.USER_ID = m.USER_ID
	WHERE u.GENDER = 'F'
	AND u.DATE_OF_BIRTH > '1990-12-20'
)fr
JOIN
(SELECT DISTINCT m.USER_ID as USER_ID, m.FNAME as FNAME, m.LNAME as LNAME, m.MAIN as MAIN
FROM ( 
  SELECT u.USER_ID as USER_ID,  u.FNAME as FNAME, u.LNAME as LNAME, f.INVITER_ID as MAIN 
  FROM FRIENDSHIPS f JOIN USERS u ON
  f.INVITEE_ID = u.USER_ID 
  WHERE f.STATUS = '1' 
  AND f.INVITER_ID IN( 	SELECT u.USER_ID
	FROM USERS u
	JOIN (
	SELECT DISTINCT(COMMENTS.USER_ID)
	FROM POSTS JOIN COMMENTS
	ON POSTS.POST_ID = COMMENTS.POST_ID
	WHERE POSTS.USER_ID=10
	)m
	ON u.USER_ID = m.USER_ID
	WHERE u.GENDER = 'F'
	AND u.DATE_OF_BIRTH > '1990-12-20') 
  AND f.INVITEE_ID != f.INVITER_ID
  
  
  UNION
  SELECT u.USER_ID as USER_ID,  u.FNAME as FNAME, u.LNAME as LNAME, f.INVITEE_ID as MAIN
  FROM FRIENDSHIPS f JOIN USERS u ON
  f.INVITER_ID = u.USER_ID 
  WHERE f.STATUS = '1' 
  AND f.INVITEE_ID IN(SELECT u.USER_ID
	FROM USERS u
	JOIN (
	SELECT DISTINCT(COMMENTS.USER_ID)
	FROM POSTS JOIN COMMENTS
	ON POSTS.POST_ID = COMMENTS.POST_ID
	WHERE POSTS.USER_ID=10
	)m
	ON u.USER_ID = m.USER_ID
	WHERE u.GENDER = 'F'
	AND u.DATE_OF_BIRTH > '1990-12-20') 
  AND f.INVITEE_ID != f.INVITER_ID) m)temp 
  
  ON fr.USER_ID = temp.MAIN
  GROUP BY fr.USER_ID;

